[tox]
envlist =
    lint
    py{311, 310, 39, 38, 37}
    safety
    docs

skip_missing_interpreters = True
isolated_build = True


[testenv:lint]
description = Run pre-commit hooks
deps = pre-commit
commands = pre-commit run --all --all-files


[testenv]
description = Run the test suite ({basepython})
package = wheel
wheel_build_env = build_wheel
depends =
    # The test suite currently cannot run in parallel due to I/O conflicts.
    # To allow tox to run other test environments (like 'docs') in parallel,
    # sequential dependencies are listed here for the test suite.
    py37: py38
    py38: py39
    py39: py310
    py310: py311
    py311: lint
extras = test
commands = pytest --color=yes --cov-report=html --cov-report=xml --cov-branch --cov-fail-under=100 {posargs}


[testenv:safety]
description = Check with safety
deps = safety
commands = safety --disable-telemetry check --full-report


[testenv:docs]
description = Build the documentation
extras = docs
commands = sphinx-build -Wab html docs/ docs/_build/html


[testenv:servedocs]
description = Host the docs locally and rebuild on changes
extras = docs
commands = sphinx-autobuild -Wa docs/ docs/_build/html --open-browser --port 9812 --watch *.md --watch *.rst --watch *.py --watch cookiecutter


[flake8]
# Excludes due to known issues or incompatibilities with black:
# BLK100: Black would make changes. https://pypi.org/project/flake8-black/
# W503: https://github.com/psf/black/search?q=W503&unscoped_q=W503
# E231: https://github.com/psf/black/issues/1202
ignore = BLK100,E231,W503
statistics = 1
# black official is 88
max-line-length = 88
